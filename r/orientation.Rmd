---
title: "Bilingualism"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(formatR.arrow=TRUE, width=68, digits=5,show.signif.stars = TRUE)
library(ggplot2)
library(party)
library(dplyr)

```

## R Markdown

We load the data and remove the cases with NA values.
```{r data, echo=FALSE}
D0<-read.csv("orientation.csv",na.strings="Err:512")
D0<-na.omit(D0)
D<-rbind(data.frame(D0[1:23],time=D0[,24],type="MATCH"),data.frame(D0[1:23],time=D0[,25],type="MISMATCH"))
D1<-D %>% select(Hand,EO,List,CEF,SRRC,PRE,POST1,POST2,STAY,LEAYRS,HRSD,RPV,AMGE,AMSP,time,type) 
# %>% transmute(LanguageAge=Age-AoA)
# D2<-D1[,c("Hand")] %>% mutate_each(funs(factor))
D1$Hand<-factor(D1$Hand)
D1$EO<-factor(D1$EO)
D1$List<-factor(D1$List)
D1$STAY<-factor(D1$STAY)

D1$CEF<-factor(D1$CEF,levels=c(3:5),ordered=TRUE)
#D1$SRRC<-factor(D1$SRRC,levels=c(1:5),ordered=TRUE)
#D1$AMGE<-factor(D1$AMGE,levels=c(1:5),ordered=TRUE)
#D1$AMSP<-factor(D1$AMSP,levels=c(1:5),ordered=TRUE)
#D1$RPV<-factor(D1$RPV,levels=c(1:5),ordered=TRUE)
i <- which(rownames(D1)=="1071")
D1<-D1[-i,]
```
```{r data2}
str(D1)
```

In total we have 225 data points. 


## Multiple Linear Regression

We try first a first order multiple linear regression model
```{r mlr1}
m<-lm(data=D1,time~.)
print(anova(m),signif.stars=TRUE)
```
and then we include all second order terms:
```{r mlr2, message=FALSE, warning=FALSE}
library(MASS)
m2<-lm(data=D1,time~.^2)
print(anova(m2),signif.stars=TRUE)
```

We apply stepwise model search procedure:

```{r mlr.stp}
model.stp<-stepAIC(aov(data=D1,time~.^2),scope=list(upper=~.^2,lower=~1),
                   direction="backward",trace=FALSE)
print(model.stp$anova,signif.stars=TRUE)
m2b<-lm(data=D1,time ~ Hand + EO + List + CEF + SRRC + PRE + POST1 + POST2 +
STAY + LEAYRS + HRSD + RPV + AMGE + AMSP + type + Hand:EO +
Hand:CEF + Hand:SRRC + Hand:PRE + Hand:POST1 + Hand:STAY +
Hand:LEAYRS + Hand:HRSD + Hand:RPV + Hand:AMGE + Hand:type +
EO:CEF + EO:SRRC + EO:PRE + EO:POST1 + EO:POST2 + EO:STAY +
EO:LEAYRS + EO:HRSD + EO:AMGE + EO:type + List:CEF + List:SRRC +
List:PRE + List:POST1 + List:POST2 + List:STAY + List:HRSD +
List:type + CEF:SRRC + CEF:PRE + CEF:POST1 + CEF:POST2 +
CEF:STAY + CEF:LEAYRS + CEF:RPV + CEF:AMGE + CEF:AMSP + CEF:type +
SRRC:POST1 + SRRC:POST2 + SRRC:STAY + SRRC:LEAYRS + SRRC:HRSD +
SRRC:RPV + SRRC:AMGE + SRRC:type + PRE:POST2 + PRE:STAY +
PRE:LEAYRS + PRE:HRSD + PRE:AMGE + PRE:type + POST1:POST2 +
POST1:STAY + POST1:LEAYRS + POST1:HRSD + POST1:RPV + POST1:AMGE +
POST1:type + POST2:STAY + POST2:LEAYRS + POST2:HRSD + POST2:RPV +
POST2:AMGE + POST2:type + STAY:LEAYRS + STAY:HRSD + STAY:RPV +
LEAYRS:type)
print(anova(m2b),signif.stars = TRUE)
anova(m2b,m2)
```

## Diagnostic plots

```{r plotlmr, fig.height=8}
par(mfrow=c(2,2))
plot(m,which=1:4)
```

From the qplot we see that the point 1071 is an outlier:
With hindsight we already remove it above. Afterwards the qqplot looks perfectly normal.


## Regression tree

Another type of analysis by means of regression tree:

```{r regtree}
ct <- ctree(data=D1,time~.^2)
ct
plot(ct)
```

From the plot we understand that regression trees find only two factors POST1 and Hand and their interaction as relevant expalin differences in the response time.

## Data visualization

We visualize the influence of the two factors that have been found explaning the most the reponse time. We separate the plots in match and mismatch cases, although this factor was found not to be important. 

```{r plots}
q<-ggplot(data=D1,aes(y=time,x=POST1,color=Hand))
q<-q+facet_grid(.~type)
q<-q+geom_point()
q<-q+geom_smooth(method=lm)
q<-q+theme(legend.position="top") 
print(q)
```

We shall conclude that the response time depends on the hand and on the general proficency in the verbs as assessed by the POST1 test. Right handed subjects with good performance in the POST1 test respond faster.
